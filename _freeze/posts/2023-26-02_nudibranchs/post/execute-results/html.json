{
  "hash": "571551526d4720fc562ebc57c17000ff",
  "result": {
    "markdown": "---\ntitle: \"Animated species distribution maps with {gifski}\"\ndescription: |\n  Mapping the distribution of a species is a useful way to understand how environmental conditions influence its habitat range. One useful way to see changes over time is by using animation to view multiple distributions in succession. Here we will model the distribution of *Nudibranchia* across Australia each month to create an animated GIF of its distribution over a year.   \nauthor:\n  - name: \"Stephanie Woolley\"\n  - name: \"Olivia Torresan\"\n  - name: \"Dax Kellie\"\ndate: \"2022-02-26\"\ntitle-block-banner: \"#B8573E\"\ntoc: true\ntoc-location: left\ntoc-depth: 3\ncategories:\n  - Eukaryota\n  - Animalia\n  - Mollusca\n  - Maps\nimage: choropleth_ggnewscale.png\nfreeze: true\ndraft: true\n---\n\n\n\n\n<!-- remove metadata section -->\n\n::: {.cell}\n<style type=\"text/css\">\n#title-block-header.quarto-title-block.default .quarto-title-meta {\n    display: none;\n}\n</style>\n:::\n\n\n\n<!-- Author card -->\n\n:::{.author-card}\n:::{.author-card-text}\n\n#### Author\nStephanie Woolley  \n[Olivia Torresan](https://labs.ala.org.au/people/Torresan_Olivia/index.html)  \n[Dax Kellie](https://labs.ala.org.au/people/Kellie_Dax/index.html)  \n\n#### Date\n26 February 2023\n\n:::\n\n:::{.author-card-image}\n\n::: {.cell}\n::: {.cell-output-display}\n![](https://raw.githubusercontent.com/AtlasOfLivingAustralia/ala-labs/main/images/people/steph.jpg){width=120px style=\"clip-path: circle();\"}\n:::\n:::\n\n:::\n\n:::{.author-card-image}\n\n::: {.cell}\n::: {.cell-output-display}\n![](https://raw.githubusercontent.com/AtlasOfLivingAustralia/ala-labs/main/images/people/olivia.jpg){width=120px style=\"clip-path: circle();\"}\n:::\n:::\n\n:::\n\n:::{.author-card-image}\n\n::: {.cell}\n::: {.cell-output-display}\n![](https://raw.githubusercontent.com/AtlasOfLivingAustralia/ala-labs/main/images/people/dax.jpg){width=120px style=\"clip-path: circle();\"}\n:::\n:::\n\n:::\n\n:::\n\n<!------------------------ Post starts here ------------------------>\n\n**Species distribution models** (SDMs) are used to predict the habitat range of different organisms. They offer some of the most informative ways to show how shifting environmental conditions affect where species occur in an area.\n\nYet species rarely stay in the same spot for long periods of time. Just like us, they react to changes in their environment, interactions with other species, and interactions with other individuals. As a result, it can be very useful to see how a distribution of a species changes in space *and* over time. In marine environments, for example, seemingly small changes in [temperature](https://theconversation.com/marine-life-in-a-south-african-bay-is-full-of-chemical-pollutants-182791), [chemicals](https://theconversation.com/marine-life-in-a-south-african-bay-is-full-of-chemical-pollutants-182791) and [light](https://theconversation.com/the-moon-and-stars-are-a-compass-for-nocturnal-animals-but-light-pollution-is-leading-them-astray-142301) can result in large changes to a species' distribution.\n\nHere we will use a series of SDMs to predict the distribution of *Nudibranchia* around Australia each month to create an animated map that shows how nudibranch distributions change over the year. \n\nThis post is inspired by [Liam Bailey's](https://twitter.com/ldbailey255) cool (and hilarious) [Bigfoot distribution map](https://twitter.com/ldbailey255/status/1575541015951593472). You can find his code  [here](https://github.com/LiamDBailey/TidyTuesday/blob/93cbe1143757c97ddaf36c564ac03a2b8088cb56/R/2022/Week37_2022.qmd).\n\n## A brief intro to species distribution models\n\nAt their simplest, SDMs are statistical models that use information of where a species has occurred to predict where it occurs over a broader area, even in places it hasn't been seen yet! \n\nSDMs are particularly informative because they can use information about the environment, added as *predictor variables*, to help calculate where a species is most likely might live. Common environmental predictor variables include temperature, rainfall, chemical concentrations and even locations of other organisms. \n\nThis means that SDMs are usually given 2 main inputs: \n\n  1. Occurrence data \n  2. Environmental variables\n\nUsing these inputs, our species distribution model can infer the *probability* of where a species occurs by combining information about where and under what environmental conditions a species is observed (or not observed) in our data. \n\n# Download data\n\n## Occurrence data\n\nLet's first download observations of *Nudibranchia* across Australia.\n\n:::{layout-ncol=3 style=\"width=120px;\"}\n\n<img class = \"clipped\" src=\"https://ala-images.s3.ap-southeast-2.amazonaws.com/store/e/f/0/2/4dc32b90-06fe-473b-ba59-1d05779c20fe/original\"></img>\n\n<img class = \"clipped\"src=\"https://ala-images.s3.ap-southeast-2.amazonaws.com/store/0/c/4/4/25048175-ab79-48c8-bea3-8f09242544c0/original\"></img>\n\n<img class = \"clipped\" src=\"https://ala-images.s3.ap-southeast-2.amazonaws.com/store/e/a/d/0/bf20b383-5812-4121-b5b7-44c0493f0dae/original\"></img>\n\n:::\n::: {.figure-caption}\nLeft: [*Doriprismatica atromarginata* (diana88jingfung CC-BY-NC 4.0 (Int))](https://biocache.ala.org.au/occurrences/4a9786d3-f68f-4bbe-9eae-38b83849ae89) Middle: [*Ceratosoma amoenum* (Erik Schlogl CC-BY-NC 4.0 (Int))](https://biocache.ala.org.au/occurrences/fde8a631-e295-4334-87fc-659e2f650e08) Right: [*Pteraeolidia ianthina* (Jallitt CC-BY-NC 4.0 (Int))](https://biocache.ala.org.au/occurrences/c5bf023e-a19d-4e75-8265-009e3493c9ef)\n:::\n\nWe'll load the necessary packages.\n\n\n::: {.cell}\n\n```{.r .cell-code}\nlibrary(galah)\nlibrary(tidyverse)\nlibrary(glue)\nlibrary(lubridate)\nlibrary(stars)         # Raster management \nlibrary(ozmaps)        # Australian map\nlibrary(SSDM)          # Linear modelling\nlibrary(sdmpredictors) # Environmental variables \nlibrary(grDevices)     # Colours and fonts\nlibrary(maps)          # Cities for map\nlibrary(tmaptools)     # Create plot ratio\nlibrary(gifski)        # Create GIF\nlibrary(knitr)         # View GIF\n```\n:::\n\n  \nNow we will use the {`galah`} package to download observations of *Nudibranchia*.\n\nYou will need to provide a [registered email with the ALA](https://auth.ala.org.au/userdetails/registration/createAccount) to `galah_config()` before retrieving records.\n\n\n::: {.cell}\n\n```{.r .cell-code}\n# Add registered email (register at ala.org.au)\ngalah_config(email = \"your-email@email.com\")\n```\n:::\n\n::: {.cell}\n\n:::\n\n::: {.cell}\n\n```{.r .cell-code}\n# Download observations\nnudibranch_occurrences <- \n  galah_call() |>                               \n  galah_identify(\"Nudibranchia\") |>   \n  galah_filter(country == \"Australia\") |>\n  galah_apply_profile(ALA) |> # ALA's set of data cleaning filters\n  atlas_occurrences() \n```\n:::\n\n\n## Environmental Variables \n\nNow we will download our environmental variables for our model.\n\nFor our *Nudibranchia* model, we will use 4 common marine environmental variables: \n\n  * Sea surface temperature \n  * Sea surface salinity \n  * Distance to shore \n  * Bathemetry \n\nTo get them, we'll use `load_layers()` from the [{sdmpredictors} package](https://github.com/lifewatch/sdmpredictors) to download our variables as raster layers (geographic layers that have a value per pixel of our variable). We'll use the `rasterstack` argument to combine our layers into one object.\n\n:::{.callout-note}\nThe {sdmpredictors} package has lots of data sets and layers available. [Check out their website to learn more](http://lifewatch.github.io/sdmpredictors/articles/quickstart.html).\n:::\n\n\n::: {.cell}\n\n```{.r .cell-code}\n# Download variables\nenv <- load_layers(layercodes = c(\"MS_biogeo08_sss_mean_5m\", \n                                  \"MS_biogeo13_sst_mean_5m\", \n                                  \"MS_biogeo05_dist_shore_5m\", \n                                  \"MS_bathy_5m\"), \n                   equalarea = FALSE, \n                   rasterstack = TRUE)\n```\n:::\n\n\nTo prepare variable data for our model, we need to crop the geographical boundaries of our data to include *only* the coast (and surrounding ocean) of Australia. With the help of the {raster} package, we'll use `extent()` to set the outer boundaries and `crop()` to remove the land.\n\n\n::: {.cell fig.aligh='center'}\n\n```{.r .cell-code}\n# Create extent\naus_ext <- raster::extent(100, 165, -45, -10)\n\n# Limit environmental variables\naus_env <- raster::crop(env, aus_ext) \n\n# Check variables \nplot(aus_env)\n```\n\n::: {.cell-output-display}\n![](post_files/figure-html/plot-layers-1.png){width=672}\n:::\n:::\n\n\n\n# Prepare data\n\nTo construct our animated GIF, we can make each \"frame\" of our animation a species distribution map of each month - that means 12 maps, January to December. \n\nIn order to do this, we'll create a set of custom functions that can:\n\n  1. Filter our nudibranch observations into a smaller `data.frame` containing observations for a specific month, \n  2. Run an SDMs on data in our smaller `data.frame`\n  3. Plot the SDM results onto a map\n  4. Save the map with a nice name\n\nBy making custom functions for these tasks, we'll be able to run each function in a loop so we can do each thing 12 times for each of our 12 months.\n \nAt the end, we'll stitch our 12 maps together and, *Voila*! We'll officially be animators (Pixar here we come!).\n\nFirst we'll need to make a few data wrangling steps to clean and organise our data:\n\n  * filter out `NA` values and duplicates (which might cause our model to error)\n  * extract month of observation into its own column with the `month()` function\n  * select month, latitude, longitude columns of each observation\n\n\n::: {.cell}\n\n```{.r .cell-code}\n# Clean, filter and convert time series to months \noccurrences_clean <- \n  nudibranch_occurrences |> \n  filter(!is.na(decimalLatitude) & !is.na(decimalLongitude)) |>\n  filter(!duplicated(decimalLatitude) & !duplicated(decimalLongitude)) |>\n  mutate(month = month(eventDate)) |>\n  select(month, \n         latitude = decimalLatitude, \n         longitude = decimalLongitude) \n\nhead(occurrences_clean)\n```\n\n::: {.cell-output .cell-output-stdout}\n```\n# A tibble: 6 × 3\n  month latitude longitude\n  <dbl>    <dbl>     <dbl>\n1    12    -55.1     159. \n2     3    -54.5     159. \n3    NA    -52.4      71.9\n4     1    -45.1     146. \n5     1    -44.3     147. \n6     1    -44.3     147. \n```\n:::\n:::\n\n\nFrom here, let's create 12 separate `data.frame`s containing observations for each month. \n\nTo help, we'll make our own function `make_months_df()` that filters our observations in `occurrences_clean` to our chosen month and selects the `latitude` and `longitude` columns: \n\n\n::: {.cell}\n\n```{.r .cell-code}\n# Build function (for each month select the lat and long)\nmake_months_df <- function(chosen_month) {\n  monthly_data <- occurrences_clean %>% \n    filter(month == {{chosen_month}}) %>%\n    select(latitude, longitude)\n}\n```\n:::\n\n\nBecause each month is assigned as a number, with the help of `purrr::map()` we can run a loop over our `make_months_df()` function by specifying which month number we want data for.\n\nLet's create a vector containing numbers 1-12 (`n_months`) which we'll loop over our function to return our 12 `data.frame`s as a `list` (`month_list`).\n\n\n::: {.cell}\n\n```{.r .cell-code}\nn_months <- c(1:12)\nmonth_list <- purrr::map(n_months, make_months_df)\n\nmonth_list[[1]] # See output of month 1\n```\n\n::: {.cell-output .cell-output-stdout}\n```\n# A tibble: 1,558 × 2\n   latitude longitude\n      <dbl>     <dbl>\n 1    -45.1      146.\n 2    -44.3      147.\n 3    -44.3      147.\n 4    -43.1      148.\n 5    -43.1      147.\n 6    -43.0      148.\n 7    -42.6      148.\n 8    -41.9      148.\n 9    -41.2      146.\n10    -41.1      146.\n# … with 1,548 more rows\n```\n:::\n:::\n\n\n\n\n# Species Distribution Model\n\nNow that `month_list` contains our 12 `data.frame`s, we're ready to make our SDM. \n\nTo build our overall SDM we will run 3 different statistical models. Each model type makes different assumptions about the data and its variation, and without getting bogged down in statistics, this just means that each model will calculate slightly different probabilities of where nudibranchs occur because of these different assumptions. \n\nWe'll then merge the 3 probabilities into one final value using [Fisher's combined probability](https://en.wikipedia.org/wiki/Fisher%27s_method). Merging multiple model results will help to balance our final value between our 3 model's results so that it is less skewed by our model choice, hopefully giving us a more conservative final estimate. \n\nWe'll build another custom function to run these models for each `data.frame` in `month_list`. We'll call this function `run_sdm_model`, and all it does is run the exact same SDM as we did earlier, but uses the chosen month for occurrences rather than the entire data set. \n\n:::{.callout-warning}\nWe've chosen to use [the model used by Liam Bailey in his Bigfooot map](https://github.com/LiamDBailey/TidyTuesday/blob/93cbe1143757c97ddaf36c564ac03a2b8088cb56/R/2022/Week37_2022.qmd). It's a fairly flexible model that suits our purposes to quickly see where nudibranchs are observed around Australia. But it is by no means the most robust SDM (and would not hold up through a more rigourous peer-review process). If you are trying to make a more informative species distribution model, you should consider another method!\n:::\n\n\n::: {.cell}\n\n```{.r .cell-code}\n# Create a function that calculates the chi squared value \nChi_sq <- function(x){     \n  1 - pchisq(q = x, df = 6)\n}\n\n# Species distribution model function\nrun_sdm_model <- function(chosen_month) {\n \n    SDM_GLM <- modelling(\"GLM\",\n                     Occurrences = (chosen_month),\n                     Env = aus_env,\n                     Xcol = 'longitude', \n                     Ycol = 'latitude', \n                     verbose = FALSE) \n  \n     SDM_MARS <- modelling(\"MARS\",\n                      Occurrences = (chosen_month),\n                      Env = aus_env,\n                      Xcol = 'longitude', \n                      Ycol = 'latitude', \n                      verbose = FALSE)\n\n     SDM_CTA <- modelling(\"CTA\",\n                     Occurrences = (chosen_month),\n                     Env = aus_env,\n                     Xcol = 'longitude', \n                     Ycol = 'latitude', \n                     verbose = FALSE)\n\n# Combine these to one value using Fisher's combined probability\ncombined <- -2 * (log(SDM_MARS@projection) + log(SDM_GLM@projection) + log(SDM_CTA@projection))\n\n# Apply the function to our data\ncombined_pval <- raster::calc(combined, fun = Chi_sq) \n\n# Convert to stars as it is easier to use with ggplot\nspecies_distribution <- stars::st_as_stars(combined_pval) \n\nreturn(species_distribution)\n\n}\n```\n:::\n\n\nNow we can use `purrr::map()` to run another loop to return results of our 12 SDMs.\n\n\n::: {.cell}\n\n```{.r .cell-code}\n# Run & save models\nmodel_list <- purrr::map(month_list, run_sdm_model) \n```\n:::\n\n\n# Map\n\nWe now have the results of our 12 SDMs in `model_list`. We can use these results to make 12 maps.\n\nTo help orient ourselves, let's download point data of the main cities in Australia to add to our maps.\n\n\n::: {.cell}\n\n```{.r .cell-code}\n# Download all cities in Australia\nworld_cities <- world.cities[world.cities$country.etc == \"Australia\",]\n\n# Filter to the specific cities for the east and west coast\ncities <- world_cities %>% \n  filter(name == \"Sydney\" | name == \"Melbourne\" | name == \"Perth\" | \n           name == \"Brisbane\" | name == \"Cairns\" | name == \"Canberra\" |\n           name == \"Adelaide\" | name == \"Melbourne\")\n```\n:::\n\n\nLet's also choose a colour palette for our map. To make our map easier to interpret, we've elected to make lower values a dark blue shade (so they look like the ocean) and higher values a brighter yellow:\n\n\n::: {.cell .fig-column-margin}\n\n```{.r .cell-code}\nblue_yellow <- c( \"#184E77\", \"#1E6091\",  \"#168AAD\",  \"#34A0A4\",  \"#52B69A\", \n                  \"#76C893\", \"#99D98C\", \"#B5E48C\",  \"#D9ED92\")\n\ncolour_palette <- colorRampPalette(blue_yellow)(50)\nfeathers::print_pal(colour_palette)\n```\n\n::: {.cell-output-display}\n![](post_files/figure-html/unnamed-chunk-16-1.png){width=672}\n:::\n:::\n\n\nNow we are ready to make maps of our results! \n\nWe'll once again make a custom function `make_the_map()` to construct each map. This function contains a few things to suit our needs:\n\n  * Plots our SDM results with `geom_stars()`\n  * Adds each month's 3-letter abbreviation `month_label` to the top of each map\n  * Limits the map to the east coast (there appears to more nudibranchs there, and zooming in will help us see the detail)\n  * Adds our nice colour palette with `scale_fill_gradientn()` & a formats a custom legend with `guide_colourbar()` \n  * Adds cities to our map\n\nLet's make some month labels: \n\n\n::: {.cell}\n\n```{.r .cell-code}\n# Get label for each month\nmonth_label <- month(1:12, label = TRUE)\nmonth_label\n```\n\n::: {.cell-output .cell-output-stdout}\n```\n [1] Jan Feb Mar Apr May Jun Jul Aug Sep Oct Nov Dec\n12 Levels: Jan < Feb < Mar < Apr < May < Jun < Jul < Aug < Sep < ... < Dec\n```\n:::\n:::\n\n\nAnd now we'll create our `make_the_map()` function:\n\n\n::: {.cell}\n\n```{.r .cell-code}\n# Map making function (for monthly SDM build this map)\nmake_the_map <- function(model_data, month_label) {\n\n  month <- {{month_label}}\n  \n  ggplot() +\n    geom_stars(data = model_data) +\n    geom_sf(\n      data = ozmaps::ozmap_states, \n      colour = \"#A9A793\", \n      fill = \"#C8C6AF\") +\n    scale_fill_gradientn(\n      colours = c(colour_palette),\n      limits = c(0, 1),\n      guide = guide_colourbar(\n        title = \"Occurrence\\nprobability\",\n        title.theme = element_text(\n          family = \"Times New Roman\",\n          colour = \"#3D4040\",\n          size = 10,\n          face = \"bold\"\n        ),\n        label.theme = element_text(\n          colour = \"#3D4040\",\n          size = 8\n        ),\n        ticks = FALSE,\n        frame.colour = \"#3D4040\",\n        title.position = \"top\",\n        title.vjust = 2,\n        label.position = \"left\"\n      ),\n      breaks = c(0, 0.5, 1),\n      labels = c(\"0%\", \"50%\", \"100%\")\n      ) +\n    # Title map with month\n    labs(\n      title = glue(\"{month_label}\")) + \n    theme_void() +\n    theme(\n      legend.position = c(1.2, 0.2), # reposition legend\n      legend.direction = \"vertical\",\n      plot.background = element_rect(fill = \"#FFFFFF\", colour = NA),\n      plot.margin = unit(c(0.01, 2.5, 0.1, 0.1), \"cm\")) +\n    # Zoom into East Coast\n    coord_sf(\n      crs = \"WGS84\",\n      xlim = c(135, 159),\n      ylim = c(-42.9, -11.5)\n      ) +\n    # Add city points\n    geom_point(\n      data = cities, \n      aes(x = long, y = lat), \n      colour = \"#3D4040\") +\n    # Add city labels\n    geom_text(\n      data = cities, \n      aes(x = long, y = lat, label = name), \n      colour = \"#3D4040\",\n      nudge_x = -1.8, \n      nudge_y = 0.6, \n      family = \"Times New Roman\")\n\n}\n```\n:::\n\n\nWe'll also create custom save function that makes sure our maps are all saved as the same dimensions, gives them a file name we can use to order our maps correctly later, and saves them as a png in a new folder called `maps`.\n\nTo figure out the best aspect ratio, we'll use the `get_asp_ratio()` function from the {tmaptools} package, and use that ratio to calculate the width of our map.\n\n\n::: {.cell}\n\n```{.r .cell-code}\n# Build a ratio based off of our distribution results\nplot_ratio <- get_asp_ratio(model_list[[1]])\n\n# Define letter to save map as (lets us import them in correct order for gif)\nletter_id <- as.list(letters[1:12])\n\n# Map-saving function\nsave_the_map <- function(chosen_map, id_label) {\n  map_label <- {{id_label}}\n  ggsave(chosen_map,\n         width = plot_ratio*4, height = 5,\n         file = glue(\"maps/map_{map_label}.png\"), \n         device = \"png\")\n}\n```\n:::\n\n\nNow we can use `map2()` to run our custom functions in a loop:\n\n\n::: {.cell}\n\n```{.r .cell-code}\n# Make SDM maps and save each map\nmodel_list %>%\n  purrr::map2(\n    .x = .,\n    .y = month_label,\n    .f = make_the_map\n  ) %>%\n  purrr::map2(\n    .x = .,\n    .y = letter_id,\n    .f = save_the_map\n  )\n```\n:::\n\n\nWe should now have 12 species distribution maps saved, and we can see them by returning all the files in our `maps` folder!\n\n\n::: {.cell}\n\n```{.r .cell-code}\nlist.files(path = \"maps/\")\n```\n\n::: {.cell-output .cell-output-stdout}\n```\n [1] \"map_a.png\" \"map_b.png\" \"map_c.png\" \"map_d.png\" \"map_e.png\" \"map_f.png\"\n [7] \"map_g.png\" \"map_h.png\" \"map_i.png\" \"map_j.png\" \"map_k.png\" \"map_l.png\"\n```\n:::\n:::\n\n\nLet's save our file names in an object so we can use them to make our GIF. We just have to use `glue()` to put the folder name on the front.\n\n\n::: {.cell}\n\n```{.r .cell-code}\n# Save file names\npng_files <- list.files(path = \"maps/\")\nmap_paths <- glue(\"maps/{png_files}\")\n```\n:::\n\n\n# Make GIF\n\nFor context before we see our animation, let's first look at the distribution of all nudibranchs across Australia (this uses all the same code as above, but without all the looping)\n\n\n::: {.cell .column-page layout-align=\"center\" height='12'}\n\n```{.r .cell-code  code-fold=\"true\"}\n## Run the 3 models on our data\nSDM_GLM <- modelling(\"GLM\",\n                     Occurrences = occurrences_clean,\n                     Env = aus_env,\n                     Xcol = 'longitude', \n                     Ycol = 'latitude', \n                     verbose = FALSE) \n\nSDM_MARS <- modelling(\"MARS\",\n                      Occurrences = occurrences_clean,\n                      Env = aus_env,\n                      Xcol = 'longitude', \n                      Ycol = 'latitude', \n                      verbose = FALSE)\n\nSDM_CTA <- modelling(\"CTA\",\n                     Occurrences = occurrences_clean,\n                     Env = aus_env,\n                     Xcol = 'longitude', \n                     Ycol = 'latitude', \n                     verbose = FALSE)\n\n# Combine these to one value using Fisher's combined probability\ncombined <- -2 * (log(SDM_MARS@projection) + log(SDM_GLM@projection) + log(SDM_CTA@projection))\n\n# Apply the function to our data\ncombined_pval <- raster::calc(combined, fun = Chi_sq) \n\n# Convert to stars as it is easier to use with ggplot\nspecies_distribution <- stars::st_as_stars(combined_pval) \n\n\n## MAP \n\nggplot() +\n  geom_stars(data = species_distribution) + # Plot SDM results\n  geom_sf(data = ozmaps::ozmap_country, # Add Australian map\n          colour = \"grey\", \n          fill = \"#C8C6AF\") + \n  coord_sf(crs = \"WGS84\", # Set geographical boundaries\n           xlim = c(112, 154), \n           ylim = c(-43, -11)) + \n  scale_fill_gradientn(\n    colours = c(colour_palette), # Use custom palette\n    limits = c(0, 1),\n    guide = guide_colourbar(\n      title = \"Occurrence probability\", # title of legend\n      title.theme = element_text( # style legend title\n        family = \"Times New Roman\", \n        colour = \"#B3B6B6\",\n        face = \"bold\",\n        size = 12\n      ),\n      label.theme = element_text( # style legend text\n        colour = \"#B3B6B6\", \n        size = 10\n      ),\n      ticks = FALSE,\n      frame.colour = \"#B3B6B6\",\n      title.position = \"top\"\n    ),\n    breaks = c(0, 0.5, 1),\n    labels = c(\"0%\", \"50%\", \"100%\")\n  ) + \n  theme_void() +\n  theme(\n    legend.position = c(0.2, 0.1),\n    legend.direction = \"horizontal\",\n    legend.key.size = unit(5, \"mm\"),\n    plot.background = element_rect(fill = \"#F7F7F3\", color = \"#F16704\"),\n    panel.border = element_rect(\n      color = \"#FFFFFF\",\n      fill = NA,\n      size = 2)\n    )\n```\n\n::: {.cell-output-display}\n![](post_files/figure-html/aus-map-1.png){fig-align='center' width=672}\n:::\n:::\n\n\nOur map shows that there are nudibranchs along pretty much the entire coastline of Australia! Their distribution appears to spread slightly further from the coast in the northern half of Australia.\n\nNow let's finish our animation by sticking our 12 monthly maps together with the [{gifski} package](https://github.com/r-rust/gifski)! \n\n\n::: {.cell}\n\n```{.r .cell-code}\n# Create animation\ngifski(map_paths, gif_file = \"SDM.gif\", delay = 0.5)\n```\n:::\n\n::: {.cell .column-page layout-align=\"center\"}\n\n```{.r .cell-code}\nknitr::include_graphics(\"SDM.gif\")\n```\n\n::: {.cell-output-display}\n![](SDM.gif){fig-align='center'}\n:::\n:::\n\n\nWe now have our animated GIF! \n\nOur animation shows that nudibranchs can be observed all year long, though there are some months where you are more likely to observe nudibranchs in more places than others.\n\nHowever, our animation also seems to have a few limitations: \n\n  * **It's hard to tell what time of the year nudibranchs are more likely to occur**  \n  Distributions predicted using more observations are less influenced by outliers. This is because our model has more information in these months to help make its predictions, which makes their results more robust. However, whether one month had more observations than another isn't something you can easily tell from our animation (a distribution doesn't necessarily get bigger when there are more observations, and smaller when there are fewer). The truth is, there are more observations of nudibranchs from October-January, and fewer from May-August. Without already knowing, we probably couldn't tell this from our map, and so our map can be misleading for someone interpreting its results. \n\n:::{.column-margin}\n\n::: {.cell}\n::: {.cell-output-display}\n![](post_files/figure-html/unnamed-chunk-25-1.png){width=672}\n:::\n:::\n\n:::\n\n  * **Some distributions are blurry**  \n  Blurriness happens when our model is less able to make specific predictions of where nudibranchs are (i.e. greater model *uncertainty*). Uncertainty can grow either because there is less data or because data are more varied in a given month. Again, just from looking at our animation, it's difficult to tell whether some months nudibranchs are distributed more widely, or whether there just wasn't much data for that month.\n  \nIn the end, our animation is a nice demonstration of how model uncertainty can make it hard to interpret results. When data are broken down into smaller and smaller groups (which often happens over the course of an entire analysis), we increase the chance of model uncertainty because there are fewer data points for our models to use. It's good to be wary of this phenomenon so you can be careful and avoid over-interpretting your results (and can be wary if you see other people doing it elsewhere)!\n\nNonetheless, we hope you've felt the thrill of constructing your own stop-motion animation with {ggplot2} and {gifski}!\n\n\n<details><summary style = \"color: #E06E53;\">Expand for session info</summary>\n\n\n::: {.cell}\n::: {.cell-output .cell-output-stdout}\n```\n─ Session info ───────────────────────────────────────────────────────────────\n setting  value\n version  R version 4.2.2 (2022-10-31 ucrt)\n os       Windows 10 x64 (build 19044)\n system   x86_64, mingw32\n ui       RTerm\n language (EN)\n collate  English_Australia.utf8\n ctype    English_Australia.utf8\n tz       Australia/Sydney\n date     2023-03-07\n pandoc   2.19.2 @ C:/Program Files/RStudio/resources/app/bin/quarto/bin/tools/ (via rmarkdown)\n\n─ Packages ───────────────────────────────────────────────────────────────────\n package       * version date (UTC) lib source\n abind         * 1.4-5   2016-07-21 [1] CRAN (R 4.2.0)\n dplyr         * 1.1.0   2023-01-29 [1] CRAN (R 4.2.2)\n forcats       * 0.5.2   2022-08-19 [1] CRAN (R 4.2.1)\n galah         * 1.5.1   2023-02-21 [1] Github (AtlasOfLivingAustralia/galah@bd43dd2)\n ggplot2       * 3.3.6   2022-05-03 [1] CRAN (R 4.2.1)\n gifski        * 1.6.6-1 2022-04-05 [1] CRAN (R 4.2.1)\n glue          * 1.6.2   2022-02-24 [1] CRAN (R 4.2.1)\n htmltools     * 0.5.4   2022-12-07 [1] CRAN (R 4.2.2)\n knitr         * 1.40    2022-08-24 [1] CRAN (R 4.2.1)\n lubridate     * 1.8.0   2021-10-07 [1] CRAN (R 4.2.1)\n maps          * 3.4.0   2021-09-25 [1] CRAN (R 4.2.1)\n ozmaps        * 0.4.5   2021-08-03 [1] CRAN (R 4.2.1)\n purrr         * 0.3.4   2020-04-17 [1] CRAN (R 4.2.1)\n readr         * 2.1.3   2022-10-01 [1] CRAN (R 4.2.2)\n sdmpredictors * 0.2.13  2022-09-13 [1] CRAN (R 4.2.1)\n sessioninfo   * 1.2.2   2021-12-06 [1] CRAN (R 4.2.1)\n sf            * 1.0-8   2022-07-14 [1] CRAN (R 4.2.1)\n SSDM          * 0.2.8   2020-02-28 [1] CRAN (R 4.2.1)\n stars         * 0.5-6   2022-07-21 [1] CRAN (R 4.2.1)\n stringr       * 1.5.0   2022-12-02 [1] CRAN (R 4.2.2)\n tibble        * 3.1.8   2022-07-22 [1] CRAN (R 4.2.1)\n tidyr         * 1.2.0   2022-02-01 [1] CRAN (R 4.2.1)\n tidyverse     * 1.3.2   2022-07-18 [1] CRAN (R 4.2.1)\n tmaptools     * 3.1-1   2021-01-19 [1] CRAN (R 4.2.2)\n\n [1] C:/Users/KEL329/R-packages\n [2] C:/Users/KEL329/AppData/Local/Programs/R/R-4.2.2/library\n\n──────────────────────────────────────────────────────────────────────────────\n```\n:::\n:::\n\n\n</details>\n",
    "supporting": [
      "post_files"
    ],
    "filters": [
      "rmarkdown/pagebreak.lua"
    ],
    "includes": {},
    "engineDependencies": {},
    "preserve": {},
    "postProcess": true
  }
}